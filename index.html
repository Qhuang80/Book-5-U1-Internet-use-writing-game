<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Media Writing Challenge</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 100%);
            color: #b8f5ff;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(184, 142, 245, 0.1) 0%, transparent 50%),
                        radial-gradient(circle, rgba(0, 242, 255, 0.1) 0%, transparent 50%);
            animation: float 20s infinite linear;
            z-index: 0;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(10%, 10%) rotate(90deg); }
            50% { transform: translate(0, 20%) rotate(180deg); }
            75% { transform: translate(-10%, 10%) rotate(270deg); }
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(15, 15, 35, 0.95);
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(184, 142, 245, 0.5),
                        0 0 100px rgba(0, 242, 255, 0.3);
            overflow: hidden;
            border: 2px solid;
            border-image: linear-gradient(135deg, #b88ef5, #00f2ff, #ff88dd) 1;
            position: relative;
            z-index: 1;
            backdrop-filter: blur(10px);
        }
        
        header {
            background: linear-gradient(135deg, #b88ef5 0%, #7a3db8 100%);
            color: #00f2ff;
            padding: 15px 20px;
            text-align: center;
            position: relative;
            overflow: visible;
            box-shadow: 0 4px 20px rgba(184, 142, 245, 0.5);
            text-shadow: 0 0 10px rgba(0, 242, 255, 0.8);
            min-height: 130px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .header-badge {
            width: 130px;
            height: 120px;
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            animation: float-badge 3s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(0, 242, 255, 0.6));
            object-fit: cover;
            object-position: center top;
        }
        
        @keyframes float-badge {
            0%, 100% { transform: translateY(-50%) rotate(0deg); }
            50% { transform: translateY(calc(-50% - 10px)) rotate(5deg); }
        }
        
        .autumn-illustration {
            width: 96%;
            max-height: 144px;
            object-fit: contain;
            display: block;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 28px;
            margin: 0;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            padding-right: 150px;
        }
        
        .subtitle {
            font-size: 20px;
            opacity: 0.95;
            font-weight: bold;
        }
        
        .game-area {
            padding: 30px;
            max-height: 85vh;
            overflow-y: auto;
        }
        
        .game-area::-webkit-scrollbar {
            width: 10px;
        }
        
        .game-area::-webkit-scrollbar-track {
            background: rgba(15, 15, 35, 0.5);
            border-radius: 5px;
        }
        
        .game-area::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #b88ef5, #00f2ff);
            border-radius: 5px;
        }
        
        .game-area::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #00f2ff, #ff88dd);
        }
        
        .input-section {
            margin-bottom: 30px;
            text-align: center;
        }
        
        .name-input {
            width: 80%;
            padding: 15px;
            border: 2px solid #b88ef5;
            border-radius: 12px;
            font-size: 20px;
            margin: 20px auto;
            display: block;
            text-align: center;
            font-weight: bold;
            background: rgba(10, 10, 30, 0.8);
            color: #00f2ff;
            box-shadow: 0 0 15px rgba(184, 142, 245, 0.3);
            transition: all 0.3s;
        }
        
        .name-input:focus {
            outline: none;
            border-color: #00f2ff;
            box-shadow: 0 0 25px rgba(0, 242, 255, 0.6);
        }
        
        .phase-container {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.9) 0%, rgba(15, 15, 35, 0.9) 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 0 20px rgba(184, 142, 245, 0.3),
                        inset 0 0 30px rgba(0, 242, 255, 0.05);
            border: 1px solid #b88ef5;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .phase-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .phase-container::-webkit-scrollbar-track {
            background: rgba(15, 15, 35, 0.5);
            border-radius: 4px;
        }
        
        .phase-container::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #b88ef5, #00f2ff);
            border-radius: 4px;
        }
        
        .phase-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #00f2ff, #ff88dd);
        }
        
        .phase-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            color: #ff88dd;
            font-weight: bold;
            font-size: 18px;
            text-shadow: 0 0 10px rgba(255, 136, 221, 0.5);
        }
        
        .sentence {
            font-size: 20px;
            line-height: 1.6;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, rgba(15, 15, 35, 0.7) 0%, rgba(26, 26, 46, 0.7) 100%);
            border-radius: 10px;
            border-left: 4px solid #00f2ff;
            font-weight: bold;
            color: #e0f7ff;
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.2);
        }
        
        .sentence-translation {
            font-size: 16px;
            color: #b88ef5;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed rgba(184, 142, 245, 0.3);
            font-style: italic;
        }
        
        .blank {
            display: inline-block;
            min-width: 120px;
            border-bottom: 2px dashed #ff88dd;
            margin: 0 5px;
            text-align: center;
            padding: 5px;
            position: relative;
            background: rgba(184, 142, 245, 0.1);
        }
        
        .hint {
            font-size: 16px;
            color: #b8f5ff;
            font-style: italic;
            margin-top: 5px;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 242, 255, 0.5);
        }
        
        .answer-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #b88ef5;
            border-radius: 12px;
            font-size: 18px;
            margin-top: 10px;
            margin-bottom: 10px;
            font-weight: bold;
            background: rgba(10, 10, 30, 0.8);
            color: #b8f5ff;
            box-shadow: 0 0 10px rgba(184, 142, 245, 0.2);
            transition: all 0.3s;
        }
        
        .answer-input:focus {
            outline: none;
            border-color: #00f2ff;
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.4);
        }
        
        .answer-input.correct {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.2);
            animation: pulse-correct 0.5s ease-out;
        }
        
        .answer-input.incorrect {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.2);
            animation: shake 0.5s ease-out;
        }
        
        @keyframes pulse-correct {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(76, 175, 80, 0.8); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .full-sentence-input {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #b88ef5;
            border-radius: 12px;
            font-size: 18px;
            margin-top: 10px;
            resize: vertical;
            font-weight: bold;
            background: rgba(10, 10, 30, 0.8);
            color: #00f2ff;
            box-shadow: 0 0 10px rgba(184, 142, 245, 0.2);
            transition: all 0.3s;
        }
        
        .full-sentence-input:focus {
            outline: none;
            border-color: #00f2ff;
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.4);
        }
        
        .btn {
            background: linear-gradient(135deg, #b88ef5 0%, #7a3db8 100%);
            color: #00f2ff;
            border: 2px solid #b88ef5;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 20px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(184, 142, 245, 0.6);
            text-shadow: 0 0 10px rgba(0, 242, 255, 0.8);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(0, 242, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 30px rgba(184, 142, 245, 0.9),
                        0 0 50px rgba(0, 242, 255, 0.5);
            border-color: #00f2ff;
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .result-section {
            text-align: center;
            padding: 40px 20px;
            display: none;
            background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%);
            border-radius: 15px;
        }
        
        .congratulations {
            font-size: 36px;
            color: #ff88dd;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 136, 221, 1),
                         0 0 40px rgba(184, 142, 245, 0.8);
            background: linear-gradient(45deg, rgba(184, 142, 245, 0.3), rgba(255, 136, 221, 0.3));
            padding: 15px;
            border-radius: 10px;
            display: inline-block;
            border: 2px solid #ff88dd;
            animation: congratulations-bounce 0.6s ease-out;
        }
        
        @keyframes congratulations-bounce {
            0% { 
                transform: translateY(-100px);
                opacity: 0;
            }
            60% {
                transform: translateY(10px);
                opacity: 1;
            }
            80% {
                transform: translateY(-5px);
            }
            100% { 
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .achievement-badge {
            width: 380px;
            height: 330px;
            margin: 20px auto;
            display: block;
            animation: badge-appear 1s ease-out, badge-glow 2s ease-in-out infinite;
            filter: drop-shadow(0 0 20px rgba(0, 242, 255, 0.8));
            object-fit: cover;
            object-position: center top;
        }
        
        @keyframes badge-appear {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            60% {
                transform: scale(1.2) rotate(10deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        @keyframes badge-glow {
            0%, 100% {
                filter: drop-shadow(0 0 20px rgba(0, 242, 255, 0.8));
            }
            50% {
                filter: drop-shadow(0 0 35px rgba(255, 136, 221, 1)) drop-shadow(0 0 50px rgba(184, 142, 245, 0.8));
            }
        }
        
        .player-name {
            font-size: 42px;
            color: #00f2ff;
            font-weight: bold;
            margin: 10px 0;
            text-shadow: 0 0 20px rgba(0, 242, 255, 1),
                         0 0 40px rgba(184, 142, 245, 0.6);
        }
        
        .score-display {
            font-size: 82px;
            color: #00f2ff;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 0 0 30px rgba(0, 242, 255, 1),
                         0 0 50px rgba(184, 142, 245, 0.8);
            animation: score-appear 0.8s ease-out;
        }
        
        @keyframes score-appear {
            0% { 
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(10deg);
            }
            100% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        .feedback {
            font-size: 24px;
            margin: 20px 0;
            line-height: 1.6;
            font-weight: bold;
            color: #d0f0ff;
        }
        
        .highlight {
            background: linear-gradient(120deg, #e94560 0%, #8a6db0 100%);
            padding: 3px 8px;
            border-radius: 5px;
            font-weight: bold;
            color: white;
        }
        
        .progress-bar {
            height: 10px;
            background: rgba(22, 33, 62, 0.8);
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
            border: 1px solid rgba(184, 142, 245, 0.3);
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #b88ef5, #00f2ff, #ff88dd);
            width: 0%;
            transition: width 0.5s;
            box-shadow: 0 0 10px rgba(184, 142, 245, 0.8);
        }
        
        .correct {
            color: #5CB85C;
            border-color: #5CB85C !important;
        }
        
        .incorrect {
            color: #D9534F;
            border-color: #D9534F !important;
        }
        
        .phase-indicator {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            color: #ff88dd;
            margin: 20px 0;
            text-shadow: 0 0 15px rgba(255, 136, 221, 0.8);
        }
        
        .word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }
        
        .word-item {
            background: rgba(26, 26, 46, 0.8);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            border: 2px solid #b88ef5;
            transition: all 0.3s;
            font-weight: bold;
            color: #b8f5ff;
            box-shadow: 0 0 10px rgba(184, 142, 245, 0.3);
        }
        
        .word-item:hover {
            background: #b88ef5;
            color: #00f2ff;
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(184, 142, 245, 0.8);
        }
        
        .word-item.used {
            background: rgba(15, 15, 35, 0.5);
            border-color: #00f2ff;
            opacity: 0.5;
            cursor: default;
            color: #00f2ff;
            box-shadow: none;
        }
        
        .underline {
            display: inline-block;
            min-width: 20px;
            border-bottom: 2px solid #ff88dd;
            margin: 0 2px;
            text-align: center;
        }
        
        .round-info {
            font-size: 18px;
            font-weight: bold;
            color: #b8f5ff;
            margin: 10px 0;
            text-shadow: 0 0 10px rgba(0, 242, 255, 0.6);
        }
        
        .round-badge {
            background: linear-gradient(135deg, #b88ef5 0%, #7a3db8 100%);
            color: #00f2ff;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            margin: 10px 0;
            border: 2px solid #b88ef5;
            box-shadow: 0 0 15px rgba(184, 142, 245, 0.6);
            text-shadow: 0 0 10px rgba(0, 242, 255, 0.8);
        }
        
        .game-complete {
            font-size: 28px;
            color: #ff88dd;
            font-weight: bold;
            margin: 20px 0;
            padding: 15px;
            background: rgba(15, 15, 35, 0.7);
            border-radius: 10px;
            border: 2px solid #b88ef5;
            box-shadow: 0 0 20px rgba(184, 142, 245, 0.5);
            text-shadow: 0 0 10px rgba(255, 136, 221, 0.8);
        }
        
        .restart-btn-large {
            background: linear-gradient(135deg, #ff88dd 0%, #b88ef5 100%);
            color: #00f2ff;
            border: 3px solid #ff88dd;
            padding: 20px 50px;
            border-radius: 50px;
            font-size: 28px;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 0 30px rgba(255, 136, 221, 0.6),
                        0 0 50px rgba(184, 142, 245, 0.4);
            text-shadow: 0 0 15px rgba(0, 242, 255, 1);
            position: relative;
            overflow: hidden;
        }
        
        .restart-btn-large::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(0, 242, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .restart-btn-large:hover::before {
            width: 400px;
            height: 400px;
        }
        
        .restart-btn-large:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 0 50px rgba(255, 136, 221, 1),
                        0 0 80px rgba(184, 142, 245, 0.8);
            border-color: #00f2ff;
        }
        
        .restart-btn-large:active {
            transform: translateY(2px);
        }
        
        @media (max-width: 600px) {
            .container {
                border-radius: 15px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .subtitle {
                font-size: 16px;
            }
            
            .game-area {
                padding: 20px;
            }
            
            .sentence {
                font-size: 18px;
            }
            
            .btn {
                padding: 12px 25px;
                font-size: 18px;
            }
            
            .autumn-illustration {
                max-height: 120px;
                width: 90%;
            }
            
            .congratulations {
                font-size: 28px;
            }
            
            .player-name {
                font-size: 32px;
            }
            
            .score-display {
                font-size: 62px;
            }
            
            .feedback {
                font-size: 18px;
            }
            
            .game-complete {
                font-size: 22px;
            }
            
            .restart-btn-large {
                padding: 15px 30px;
                font-size: 22px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img src="https://youke1.picui.cn/s1/2025/10/27/68ff56cdcd486.png" alt="Badge" class="header-badge">
            <h1>Social Media Writing Challenge</h1>
        </header>
        
        <div class="game-area">
            <div class="input-section">
                <h2 style="color: #ff88dd; margin-bottom: 15px; text-shadow: 0 0 15px rgba(255, 136, 221, 0.8);">Enter Your Name</h2>
                <input type="text" class="name-input" id="studentName" placeholder="Type your name here">
                <button class="btn" id="startBtn">Start Challenge</button>
            </div>
            
            <div id="gameContent" style="display:none;">
                <!-- Round info -->
                <div class="round-info" id="roundInfo">Round 1</div>
                
                <!-- Progress bar -->
                <div class="progress-bar">
                    <div class="progress" id="progressBar"></div>
                </div>
                
                <!-- Phase indicator -->
                <div class="phase-indicator" id="phaseIndicator">Phase 1: Fill in the Blanks</div>
                
                <!-- Sentence exercises will be inserted here -->
                <div id="exercisesContainer"></div>
                
                <button class="btn" id="submitBtn" style="display:none;">Check Answers</button>
            </div>
            
            <div class="result-section" id="resultSection">
                <div class="congratulations">Congratulations!</div>
                <img src="https://youke1.picui.cn/s1/2025/10/27/68ff56cdcd486.png" alt="Achievement Badge" class="achievement-badge">
                <div class="player-name" id="playerNameDisplay"></div>
                <div class="score-display" id="scoreDisplay">0</div>
                <div class="round-badge" id="roundBadge">Round 1 Completed</div>
                <div class="game-complete">Game Complete!</div>
                <div class="feedback" id="feedbackText"></div>
                <button class="restart-btn-large" id="restartBtn">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        // Model essay sentences
        const sentences = [
            "It's widely recognized that the strengths of online shopping outweigh its weaknesses.",
            "In addition, it will be beneficial to pursue some hobbies, which I believe will contribute to less online time.",
            "I'm writing to convey my deepest concern over students' addiction to mobile phones.",
            "The event will make a big difference to teenagers. Only by staying away from social media platforms and the virtual world can we be absorbed in our study and interact more with people in reality.",
            "So severe is students' addiction to video games that due attention should be paid to addressing it.",
            "I would appreciate it if you take my suggestions into consideration.",
            "The occurrence of social media has played an increasingly critical role in our life, which brought numerous benefits and enormous problems as well."
        ];
        
        // Chinese translations for Phase 1
        const translations = [
            "人们普遍认为网上购物的优点胜过其缺点。",
            "此外，培养一些爱好也是有益的，我相信这将有助于减少上网时间。",
            "我写信想说说学生沉迷于手机的问题。",
            "这项活动将会对青少年产生重大影响。只有远离社交媒体平台和虚拟世界，我们才能专注于学习并与现实中的人交往。",
            "学生沉迷于网络游戏如此严重，应该给予足够的关注来解决这个问题。",
            "如果你能考虑我的建议，我将非常感激。",
            "社交媒体的出现在我们的生活中发挥着越来越重要的作用，但同时也带来了很大的问题。"
        ];

        // Key expressions for each sentence
        const keyExpressions = [
            ["widely", "recognized", "strengths", "outweigh", "weaknesses"],
            ["In addition", "beneficial", "pursue", "contribute to"],
            ["convey", "concern", "over", "addiction to"],
            ["make a big difference", "staying away from", "platforms", "virtual world", "be absorbed in", "interact"],
            ["So severe", "addiction to", "video games", "due attention", "addressing"],
            ["would appreciate it", "take", "into consideration"],
            ["occurrence", "an increasingly critical role", "numerous benefits", "enormous", "as well"]
        ];

        let currentPhase = 1;
        let currentSentenceIndex = 0;
        let score = 0;
        let totalScore = 0;
        let currentRound = 1;
        
        // Calculate max possible score
        let maxPossibleScore = 0;
        for (let i = 0; i < sentences.length; i++) {
            maxPossibleScore += keyExpressions[i].length * 3; // Phases 1-3
        }

        // Sound effects
        function playSound(type) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            if (type === 'correct') {
                // Correct answer - pleasant chime
                const oscillator1 = audioContext.createOscillator();
                const oscillator2 = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator1.connect(gainNode);
                oscillator2.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator1.frequency.value = 880;
                oscillator2.frequency.value = 1100;
                oscillator1.type = 'sine';
                oscillator2.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                
                oscillator1.start(audioContext.currentTime);
                oscillator2.start(audioContext.currentTime + 0.05);
                oscillator1.stop(audioContext.currentTime + 0.4);
                oscillator2.stop(audioContext.currentTime + 0.4);
            } else if (type === 'incorrect') {
                // Incorrect answer - lower tone
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 300;
                oscillator.type = 'sawtooth';
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'complete') {
                // Game complete - celebratory melody
                const notes = [523.25, 587.33, 659.25, 783.99, 880.00, 1046.50];
                notes.forEach((freq, index) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = freq;
                    oscillator.type = 'sine';
                    
                    const startTime = audioContext.currentTime + index * 0.12;
                    gainNode.gain.setValueAtTime(0.15, startTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);
                    
                    oscillator.start(startTime);
                    oscillator.stop(startTime + 0.3);
                });
            } else if (type === 'click') {
                // Button click - subtle beep
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 600;
                oscillator.type = 'square';
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.08);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.08);
            } else if (type === 'phase-start') {
                // Phase start - ascending tone
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.3);
                oscillator.type = 'triangle';
                
                gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'perfect') {
                // Perfect score - triumphant fanfare
                const notes = [659.25, 783.99, 1046.50, 1318.51];
                notes.forEach((freq, index) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = freq;
                    oscillator.type = 'sine';
                    
                    const startTime = audioContext.currentTime + index * 0.15;
                    gainNode.gain.setValueAtTime(0.2, startTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.5);
                    
                    oscillator.start(startTime);
                    oscillator.stop(startTime + 0.5);
                });
            }
        }

        // Initialize game
        document.getElementById('startBtn').addEventListener('click', function() {
            const studentName = document.getElementById('studentName').value.trim();
            if (!studentName) {
                alert('Please enter your name');
                return;
            }
            
            playSound('click');
            document.querySelector('.input-section').style.display = 'none';
            document.getElementById('gameContent').style.display = 'block';
            
            setTimeout(() => {
                playSound('phase-start');
                startPhase();
            }, 100);
        });
        
        function startPhase() {
            const exercisesContainer = document.getElementById('exercisesContainer');
            exercisesContainer.innerHTML = '';
            
            document.getElementById('phaseIndicator').textContent = `Phase ${currentPhase}: ${getPhaseName(currentPhase)}`;
            document.getElementById('roundInfo').textContent = `Round ${currentRound}`;
            
            if (currentPhase === 1) {
                createFillInTheBlanksExercise(true); // Phase 1: Fill in the blanks with hints
                document.getElementById('submitBtn').style.display = 'block';
            } else if (currentPhase === 2) {
                createWordBankExercise(); // Phase 2: Word bank challenge
                document.getElementById('submitBtn').style.display = 'block';
            } else if (currentPhase === 3) {
                createFillInTheBlanksExercise(false); // Phase 3: Fill in the blanks without hints
                document.getElementById('submitBtn').style.display = 'block';
            }
            
            // Play phase start sound if not the first sentence
            if (currentSentenceIndex > 0 || currentPhase > 1) {
                playSound('phase-start');
            }
            
            updateProgress();
        }
        
        function getPhaseName(phase) {
            switch(phase) {
                case 1: return "Fill in the Blanks (with hints)";
                case 2: return "Word Bank Challenge";
                case 3: return "Fill in the Blanks (no hints)";
                default: return "";
            }
        }
        
        function createFillInTheBlanksExercise(withHints = true) {
            const sentence = sentences[currentSentenceIndex];
            const expressions = keyExpressions[currentSentenceIndex];
            
            let processedSentence = sentence;
            
            expressions.forEach(expr => {
                const underlines = createUnderlines(expr);
                const blank = withHints 
                    ? `<span class="blank" data-answer="${expr}" data-hint="${getHint(expr)}">${underlines}</span>`
                    : `<span class="blank" data-answer="${expr}">${underlines}</span>`;
                processedSentence = processedSentence.replace(expr, blank);
            });
            
            const exerciseDiv = document.createElement('div');
            exerciseDiv.className = 'phase-container';
            exerciseDiv.innerHTML = `
                <div class="phase-header">
                    <span>Sentence ${currentSentenceIndex + 1} of ${sentences.length}</span>
                </div>
                <div class="sentence">
                    ${processedSentence}
                    ${withHints && currentPhase === 1 ? `<div class="sentence-translation">${translations[currentSentenceIndex]}</div>` : ''}
                </div>
                ${withHints ? `<div class="hint">Hint: ${expressions.map(e => getHint(e)).join(', ')}</div>` : ''}
                <div id="inputsContainer"></div>
            `;
            
            document.getElementById('exercisesContainer').appendChild(exerciseDiv);
            
            const inputsContainer = document.getElementById('inputsContainer');
            expressions.forEach((expr, index) => {
                const inputWrapper = document.createElement('div');
                inputWrapper.style.marginBottom = '15px';
                
                const label = document.createElement('div');
                label.style.color = '#00f2ff';
                label.style.fontSize = '14px';
                label.style.marginBottom = '5px';
                label.style.fontWeight = 'bold';
                label.textContent = `Expression ${index+1}:`;
                
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'answer-input';
                input.dataset.expressionIndex = index;
                input.placeholder = `Fill in expression ${index+1}`;
                
                inputWrapper.appendChild(label);
                inputWrapper.appendChild(input);
                inputsContainer.appendChild(inputWrapper);
            });
        }
        
        function createWordBankExercise() {
            const sentence = sentences[currentSentenceIndex];
            const expressions = keyExpressions[currentSentenceIndex];
            
            let allWords = [];
            expressions.forEach(expr => {
                allWords = allWords.concat(expr.split(' '));
            });
            
            const distractors = ['reading', 'writing', 'thinking', 'painting', 'discussion', 'traditional', 'modern', 'simple', 'internet', 'technology'];
            allWords = allWords.concat(distractors);
            
            allWords = shuffleArray(allWords);
            
            let processedSentence = sentence;
            
            expressions.forEach(expr => {
                const underlines = createUnderlines(expr);
                processedSentence = processedSentence.replace(expr, `<span class="blank">${underlines}</span>`);
            });
            
            const exerciseDiv = document.createElement('div');
            exerciseDiv.className = 'phase-container';
            exerciseDiv.innerHTML = `
                <div class="phase-header">
                    <span>Sentence ${currentSentenceIndex + 1} of ${sentences.length}</span>
                </div>
                <div class="sentence">${processedSentence}</div>
                <div class="hint">Use words from the bank below to complete the sentence:</div>
                <div class="word-bank" id="wordBank"></div>
                <div id="inputsContainer"></div>
            `;
            
            document.getElementById('exercisesContainer').appendChild(exerciseDiv);
            
            // Create input containers first
            const inputsContainer = document.getElementById('inputsContainer');
            expressions.forEach((expr, index) => {
                const inputWrapper = document.createElement('div');
                inputWrapper.style.marginBottom = '15px';
                
                const label = document.createElement('div');
                label.style.color = '#00f2ff';
                label.style.fontSize = '14px';
                label.style.marginBottom = '5px';
                label.style.fontWeight = 'bold';
                label.textContent = `Expression ${index+1} (${expr.split(' ').length} word${expr.split(' ').length > 1 ? 's' : ''}):`;
                
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'answer-input';
                input.dataset.expressionIndex = index;
                input.dataset.expectedWords = expr.split(' ').length;
                input.placeholder = `Fill in ${expr.split(' ').length} word${expr.split(' ').length > 1 ? 's' : ''}`;
                
                inputWrapper.appendChild(label);
                inputWrapper.appendChild(input);
                inputsContainer.appendChild(inputWrapper);
            });
            
            const wordBank = document.getElementById('wordBank');
            allWords.forEach(word => {
                const wordElement = document.createElement('div');
                wordElement.className = 'word-item';
                wordElement.textContent = word;
                wordElement.addEventListener('click', function() {
                    if (!this.classList.contains('used')) {
                        // Find the first input that doesn't have enough words yet
                        const inputs = document.querySelectorAll('.answer-input');
                        for (let input of inputs) {
                            const currentWords = input.value.trim().split(/\s+/).filter(w => w.length > 0);
                            const expectedWords = parseInt(input.dataset.expectedWords);
                            
                            if (currentWords.length < expectedWords) {
                                // Add the word to this input
                                if (currentWords.length === 0) {
                                    input.value = this.textContent;
                                } else {
                                    input.value = input.value.trim() + ' ' + this.textContent;
                                }
                                this.classList.add('used');
                                break;
                            }
                        }
                    }
                });
                wordBank.appendChild(wordElement);
            });
        }
        
        function getHint(expression) {
            return expression.split(' ').map(word => word.charAt(0)).join(' ');
        }
        
        function createUnderlines(expression) {
            const words = expression.split(' ');
            let underlinesHTML = '';
            
            words.forEach(word => {
                const wordLength = word.length;
                underlinesHTML += `<span class="underline" style="width: ${wordLength * 10}px;">&nbsp;</span> `;
            });
            
            return underlinesHTML.trim();
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        document.getElementById('submitBtn').addEventListener('click', function() {
            playSound('click');
            if (currentPhase === 1 || currentPhase === 2 || currentPhase === 3) {
                checkFillInTheBlanks();
            }
        });
        
        function checkFillInTheBlanks() {
            const inputs = document.querySelectorAll('.answer-input');
            let allCorrect = true;
            score = 0;
            
            inputs.forEach(input => {
                const expressionIndex = parseInt(input.dataset.expressionIndex);
                const correctAnswer = keyExpressions[currentSentenceIndex][expressionIndex].toLowerCase();
                const userAnswer = input.value.trim().toLowerCase();
                
                // Check if answer is correct
                let isCorrect = false;
                if (userAnswer === correctAnswer) {
                    isCorrect = true;
                }
                
                if (isCorrect) {
                    input.classList.add('correct');
                    score++;
                    playSound('correct');
                } else {
                    input.classList.add('incorrect');
                    allCorrect = false;
                    playSound('incorrect');
                    
                    const correctText = document.createElement('div');
                    correctText.className = 'hint correct';
                    correctText.textContent = `Correct: ${correctAnswer}`;
                    input.parentNode.insertBefore(correctText, input.nextSibling);
                }
                
                input.disabled = true;
            });
            
            totalScore += score;
            
            // Move to next phase automatically
            setTimeout(() => {
                currentSentenceIndex++;
                if (currentSentenceIndex >= sentences.length) {
                    currentSentenceIndex = 0;
                    currentPhase++;
                    if (currentPhase > 3) { // Only 3 phases now
                        showResults();
                        return;
                    }
                }
                
                startPhase();
            }, 1500);
        }
        
        document.getElementById('restartBtn').addEventListener('click', function() {
            playSound('click');
            document.getElementById('resultSection').style.display = 'none';
            document.querySelector('.input-section').style.display = 'block';
            document.getElementById('studentName').value = '';
            document.getElementById('studentName').focus();
            
            currentRound++;
            currentPhase = 1;
            currentSentenceIndex = 0;
            score = 0;
            totalScore = 0;
        });
        
        function updateProgress() {
            const progress = ((currentSentenceIndex + 1) / sentences.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }
        
        function showResults() {
            document.getElementById('gameContent').style.display = 'none';
            document.getElementById('resultSection').style.display = 'block';
            
            const studentName = document.getElementById('studentName').value.trim();
            const percentage = Math.round((totalScore / maxPossibleScore) * 100);
            
            // Display player name and score prominently
            document.getElementById('playerNameDisplay').textContent = studentName;
            document.getElementById('scoreDisplay').textContent = `${percentage}%`;
            document.getElementById('roundBadge').textContent = `Round ${currentRound} Completed`;
            
            // Personalized feedback
            let feedback = '';
            if (percentage === 100) {
                feedback = `Perfect Score! Absolutely incredible! You've achieved perfection in mastering the key expressions!`;
                playSound('perfect');
            } else if (percentage >= 90) {
                feedback = `Outstanding performance! You've mastered the key expressions in social media writing.`;
                playSound('complete');
            } else if (percentage >= 70) {
                feedback = `Excellent work! You understand most of the important vocabulary and expressions.`;
                playSound('complete');
            } else if (percentage >= 50) {
                feedback = `Good effort! You've got some of the key expressions right.`;
                playSound('complete');
            } else {
                feedback = `Keep practicing! Focus on the key expressions for improvement.`;
                playSound('complete');
            }
            
            feedback += `<br><br>Your final score: ${totalScore} / ${maxPossibleScore} points`;
            document.getElementById('feedbackText').innerHTML = feedback;
        }
    </script>
</body>
</html>
